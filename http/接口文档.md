## 前言

* 返回结果状态码code=0表示成功，非0表示出现问题

*  一般将token 放在请求头中并进行简单加盐，格式为 "Authorization" : "cuit  token字段"  （注意cuit和token之间有一个空格）

* 在线接口文档地址 http://api.littledongdong.top/docs

* baseurl ： http://api.littledongdong.top



## 登录注册

### 后台管理页面

url: /admin/

默认管理员：

* username: admin1234
* password: admin1234



### 验证码

此接口使用时要求用户是未注册的，即数据库中没有用户的邮箱，此接口用于实现注册时发送邮箱验证码

url: api/emailcodes/

请求方式：post

请求体参数：

```json
{
    "email":"1993981461@qq.com" 
}
```

* email为用户注册所填的邮箱，必填

成功后返回数据：

```json
{
    "status": 0,
    "msg": "ok",
    "email": "1993981461@qq.com"
}
```

* 同时会向该邮箱发送一个六位验证码，验证码有效期30min，限制发送间隔60s





### 注册

url：api/register/

请求方式：post

请求体参数：

```json
{
    "email":"1993981461@qq.com",
    "password":"user",
    "password2":"user",
    "code":"714540"
}
```

| 请求参数  | 必选 | 参数类型 | 说明       |
| --------- | ---- | -------- | ---------- |
| email     | true | Sring    | 为注册邮箱 |
| password  | true | String   | 密码       |
| password2 | true | String   | 重复密码   |
| code      | true | String   | 验证码     |

成功后返回数据：

```json
{
    "status": 0,
    "msg": "ok",
    "results": {
        "id": 7,
        "username": "1993981461@qq.com",
        "email": "1993981461@qq.com"
    },
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo3LCJ1c2VybmFtZSI6IjE5OTM5ODE0NjFAcXEuY29tIiwiZXhwIjoxNTk1MzIyNzgxLCJlbWFpbCI6IjE5OTM5ODE0NjFAcXEuY29tIn0.KONeDky1uYRjpgLJ5G50eYlbxMKK8F9d9TWxRlGMEDs"
}
```



### 登录

url：api/login

请求方式：post

请求体参数：

```json
{
    "user":"1993981461@qq.com",
    "password":"user"
}
```

| 请求参数 | 必选 | 参数类型 | 说明                                                         |
| -------- | ---- | -------- | ------------------------------------------------------------ |
| user     | true | Sring    | user可以是username或email。刚注册后两者默认相同，username可以在个人中心中修改为其他唯一的字符串 |
| password | true | String   | 密码                                                         |

成功后返回数据：

```json
{
    "status": 0,
    "msg": "ok",
    "results": {
        "id": 7,
        "username": "1993981461@qq.com",
        "email": "1993981461@qq.com"
    },
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo3LCJ1c2VybmFtZSI6IjE5OTM5ODE0NjFAcXEuY29tIiwiZXhwIjoxNTk1MzIzNjM5LCJlbWFpbCI6IjE5OTM5ODE0NjFAcXEuY29tIn0.eCvY9nROXvrvIj5hDjGrIYQUOHNIIUcGAiTy0cElHns"
}
```





## 用户个人数据

### 用户查看自己的信息

url：api/users/detail/{id}/

请求方式：get

请求头格式：Authorization：'cuit' + 空格 + token

必须携带token，token中的用户id必须与url中id一致

没有携带token的返回数据：

```json
{
    "detail": "身份认证信息未提供。"
}
```

携带token但与url中id不一致

```json
{
    "detail": "您没有执行该操作的权限。"
}
```

携带token请求成功：

```json
{
    "status": 0,
    "msg": "ok",
    "results": {
        "id": 7,
        "username": "1993981461@qq.com",
        "email": "1993981461@qq.com",
        "sign": "common",
        "avatar": null,
        "gender": "no",
        "age": null,
        "enrollment_time": null,
        "last_login": null,
        "major": "",
        "student_id": null,
        "introduction": null
    }
}
```



### 用户更新个人信息

url：api/users/detail/{id}/

请求方式：put/patch

必须携带token，token中的用户id必须与url中id一致

请求体参数：

```json
{
        "username": "1993981461@qq.com",
        "gender": "male",
        "age": 18,
        "enrollment_time": 2018,
        "major": "计科",
        "student_id": 2018051171,
        "introduction": "这里是简介/个性签名"
}
```

| 请求参数        | 必选                            | 参数类型 | 参数名称      | 说明                                                |
| --------------- | ------------------------------- | -------- | ------------- | --------------------------------------------------- |
| username        | put请求中true；patch请求中false | String   | 用户名        | **修改用户名会返回新的token**，用户名支持中文用户名 |
| gender          | false                           | String   | 性别          | 可选值：male 男生、female 女生、no(默认) 未知       |
| age             | false                           | Int      | 年龄          | 后端限制年龄 0 ~ 100                                |
| enrollment_time | false                           | Int      | 入学年份      | 入学年份限制2000~ 2050                              |
| major           | false                           | String   | 专业          | 专业名字限制100个字符                               |
| student_id      | false                           | Int      | 学号          | 学号限制3~50个字符                                  |
| introduction    | false                           | String   | 简介/个性签名 | 限制一万字之内                                      |

成功后返回数据：

```json
{
    "status": 0,
    "msg": "ok",
    "results": {
        "id": 7,
        "username": "1993981461@qq.com",
        "email": "1993981461@qq.com",
        "sign": "senior",
        "avatar": null,
        "gender": "male",
        "age": 18,
        "enrollment_time": 2018,
        "major": "计科",
        "student_id": 2018051171,
        "introduction": "这里是简介/个性签名"
    },
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo3LCJ1c2VybmFtZSI6IjE5OTM5ODE0NjFAcXEuY29tIiwiZXhwIjoxNTk1MzM3NDE4LCJlbWFpbCI6IjE5OTM5ODE0NjFAcXEuY29tIn0.T69yMn5KCj6mXmxzYiZyOp6hJdQvLjM3Yf7sWAemo94"
}
```



### 根据旧密码修改密码

url：api/users/oldpassword/{id}/

请求方式：post

必须携带token，token中的用户id必须与url中id一致

请求体参数：

```json
{
    "old_password":"user",
    "new_password":"user1",
    "new_password2":"user1"
}
```

| 请求参数      | 必选 | 参数类型 | 参数名称                   |
| ------------- | ---- | -------- | -------------------------- |
| old_password  | true | String   | 原密码                     |
| new_password  | true | String   | 新密码                     |
| new_password2 | true | String   | 校验密码，必须与新密码一致 |

成功返回数据：

```json
{
    "status": 0,
    "msg": "修改密码成功"
}
```





### 根据邮箱修改密码/找回密码

这个接口有两个应用场景：1、用户在个人中心选择通过验证邮箱来修改密码 	2、用户在登录时忘记密码，通过验证邮箱重新设置密码

修改密码/找回密码功能是通过两次请求实现的，此接口使用时须向通过 **验证码** 的接口先发送验证码，再使用此接口

url：api/users/emailpassword/{id}/

请求方式：post

~~必须携带token，token中的用户id必须与url中id一致~~

请求体参数：

```json
{
    "email":"1993981461@qq.com",
    "code":"718924",
    "password":"user1",
    "password2":"user1"
}
```

| 请求参数  | 必选 | 参数类型 | 参数名称         |
| --------- | ---- | -------- | ---------------- |
| email     | true | String   | 发送验证码的邮箱 |
| code      | true | String   | 收到的验证码     |
| password  | true | String   | 新密码           |
| password2 | true | String   | 校验密码         |

成功后收到的数据：

```json
{
    "status": 0,
    "msg": "修改密码成功"
}
```





### 修改邮箱

修改邮箱需要验证新邮箱，新邮箱必须未在数据库中注册

是通过两次请求实现的，此接口使用时须向通过 **验证码** 的接口先发送验证码，再使用此接口

url：api/users/emailreset/{id}/

请求方式：post

必须携带token，token中的用户id必须与url中id一致

请求体参数：

```json
{
    "email":"3460457627@qq.com",
    "code":"620441"
}
```

| 请求参数 | 必选 | 参数类型 | 参数名称         |
| -------- | ---- | -------- | ---------------- |
| email    | true | String   | 发送验证码的邮箱 |
| code     | true | String   | 收到的验证码     |

成功后返回数据

```json
{
    "status": 0,
    "msg": "ok",
    "results": {
        "id": 7,
        "username": "中文用户名",
        "email": "3460457627@qq.com"
    },
    "token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjo3LCJ1c2VybmFtZSI6Ilx1NGUyZFx1NjU4N1x1NzUyOFx1NjIzN1x1NTQwZCIsImV4cCI6MTU5NTQyOTA1MCwiZW1haWwiOiIzNDYwNDU3NjI3QHFxLmNvbSJ9.MWNByjFgUV__ALqIX5Lp3CYNe3Kfg5OsvMZHbNATAis"
}
```



### 更新头像

url：api/users/avatar/{id}/

必须携带token，token中的用户id必须与url中id一致

请求方式：post

数据提交方式：multipart/form-data

键值对："avatar": 图片文件

图片作为头像，限制大小为2MB，后期会增加类型限制

图片直接在后端转为base64存数据库，向前端返回图片的base64数据

 ```json
{
    "status": 0,
    "msg": "ok",
    "avatar": "/9j/4AAQSkZJRgABAQEASABIAAD/2wBDAAMCAgMCAgMDAwMEAwMEBQgFBQQEBQoHBwYIDAoMDAsKCwsNDhIQDQ4RDgsLEBYQERMUFRUVDA8XGBYUGBIUFRT/2wBDAQMEBAUEBQkFBQkUDQsNFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBT/wAARCAHwArIDASIAAhEBAxEB/8QAHwAAAQUBAQEBAQEAAAAAAAAAAAECAwQFBgcICQoL/8QAtRAAAgEDAwIEAwUFBAQAAAF9AQIDAAQRBRIhMUEGE1FhByJxFDKBkaEII0KxwRVS0fAkM2JyggkKFhcYGRolJicoKSo0NTY3ODk6Q0RFRkdISUpTVFVWV1hZWmNkZWZnaGlqc3R1dnd4eXqDhIWGh4iJipKTlJWWl5iZmqKjpKWmp6ipqrKztLW2t7i5usLDxMXGx8jJytLT1NXW19jZ2uHi4+Tl5ufo6erx8vP09fb3+Pn6/8QAHwEAAwEBAQEBAQEBAQAAAAAAAAECAwQFBgcICQoL/8QAtREAAgECBAQDBAcFBAQAAQJ3AAECAxEEBSExBhJBUQdhcRMiMoEIFEKRobHBCSMzUvAVYnLRChYkNOEl8RcYGRomJygpKjU2Nzg5OkNERUZHSElKU1RVVldYWVpjZGVmZ2hpanN0dXZ3eHl6goOEhYaHi
太长了。。省略一部分
}
 ```



## 其他用户数据

### 用户简略信息列表

url：api/users/simple/

请求方式：get

成功请求数据：

```json
{
    "count": 4,
    "next": "http://127.0.0.1:8000/api/users/simple/?page=2",
    "previous": null,
    "results": [
        {
            "id": 1,
            "username": "3460457627@qq.com",
            "email": "admin@qq.com",
            "sign": "高级用户",
            "avatar": "",
            "gender": "未知",
            "enrollment_time": null,
            "major": "",
            "introduction": ""
        },
        {
            "id": 5,
            "username": "superuser",
            "email": "superuser@qq.com",
            "sign": "普通用户",
            "avatar": null,
            "gender": "未知",
            "enrollment_time": null,
            "major": "",
            "introduction": null
        },
        {
            "id": 6,
            "username": "superuser1",
            "email": "superuser1@qq.com",
            "sign": "普通用户",
            "avatar": null,
            "gender": "未知",
            "enrollment_time": null,
            "major": "",
            "introduction": null
        }
    ]
}
```

默认一页展示10条数据，上面的示例设置为了一页展示3条数据





### 展示单个用户的简略信息

url：api/users/simple/{id}/

请求方式：get

成功请求数据：

```json
{
    "id": 7,
    "username": "中文用户名",
    "email": "3460457627@qq.com",
    "sign": "高级用户",
    "avatar": "",
    "gender": "男",
    "enrollment_time": 2018,
    "major": "计科",
    "introduction": "这里是简介/个性签名"
}
```



## 文章信息

### 分类

#### 获取所有分类

url：api/categorys/

请求方式：get

请求数据：

```json
[
    {
        "id": 1,
        "name": "文章类型",
        "tag_info": {
            "1": {
                "id": 4,
                "name": "提问"
            },
            "2": {
                "id": 5,
                "name": "项目记录"
            },
            "3": {
                "id": 6,
                "name": "学习分享"
            },
            "4": {
                "id": 7,
                "name": "知识库"
            },
            "5": {
                "id": 8,
                "name": "公告"
            },
            "6": {
                "id": 9,
                "name": "资源分享"
            }
        },
        "created_time": "2020-06-22T18:23:55.996283"
    },
    {
        "id": 2,
        "name": "工具/环境",
        "tag_info": {
            "1": {
                "id": 3,
                "name": "vscode"
            }
        },
        "created_time": "2020-06-22T18:24:01.899461"
    },
    {
        "id": 3,
        "name": "语言",
        "tag_info": {
            "1": {
                "id": 1,
                "name": "c/c++"
            }
        },
        "created_time": "2020-06-22T18:24:06.978064"
    },
    {
        "id": 4,
        "name": "技术类别",
        "tag_info": {
            "1": {
                "id": 2,
                "name": "计算机视觉"
            }
        },
        "created_time": "2020-06-22T18:24:12.522767"
    }
]
```





#### 获取不包含高级标签的分类

url：api/usercategorys/

请求方式：get

请求数据：

```json
[
    {
        "id": 1,
        "name": "文章类型",
        "tag_info": {
            "1": {
                "id": 4,
                "name": "提问"
            },
            "2": {
                "id": 5,
                "name": "项目记录"
            },
            "3": {
                "id": 6,
                "name": "学习分享"
            },
            "4": {
                "id": 9,
                "name": "资源分享"
            }
        },
        "created_time": "2020-06-22T18:23:55.996283"
    },
    {
        "id": 2,
        "name": "工具/环境",
        "tag_info": {
            "1": {
                "id": 3,
                "name": "vscode"
            }
        },
        "created_time": "2020-06-22T18:24:01.899461"
    },
    {
        "id": 3,
        "name": "语言",
        "tag_info": {
            "1": {
                "id": 1,
                "name": "c/c++"
            }
        },
        "created_time": "2020-06-22T18:24:06.978064"
    },
    {
        "id": 4,
        "name": "技术类别",
        "tag_info": {
            "1": {
                "id": 2,
                "name": "计算机视觉"
            }
        },
        "created_time": "2020-06-22T18:24:12.522767"
    }
]
```





#### 查看具体分类

url：api/categorys/{id}/

请求方式：get

请求数据：

```json
{
    "id": 1,
    "name": "文章类型",
    "tag_info": {
        "1": {
            "id": 4,
            "name": "提问"
        },
        "2": {
            "id": 5,
            "name": "项目记录"
        },
        "3": {
            "id": 6,
            "name": "学习分享"
        },
        "4": {
            "id": 7,
            "name": "知识库"
        },
        "5": {
            "id": 8,
            "name": "公告"
        },
        "6": {
            "id": 9,
            "name": "资源分享"
        }
    },
    "created_time": "2020-06-22T18:23:55.996283"
}
```





### 标签

#### 查看某具体的标签内容

url：api/tags/{id}/

请求方式：get

返回数据：

```json
{
    "id": 4,
    "name": "提问",
    "category_info": {
        "id": 1,
        "name": "文章类型"
    },
    "article_info": {},
    "created_time": "2020-06-22T18:25:22.187016"
}
```





#### 获取所有标签

```json
{
    "count": 2,
    "next": null,
    "previous": null,
    "results": [
        {
            "id": 1,
            "name": "c/c++",
            "category_info": {
                "id": 3,
                "name": "语言"
            },
            "article_info": {
                "1": {
                    "id": 3,
                    "title": "测试tag新增",
                    "excerpt": "未加tag情况"
                },
                "2": {
                    "id": 4,
                    "title": "测试tag新增",
                    "excerpt": "添加高级tag情况"
                },
                "3": {
                    "id": 5,
                    "title": "测试tag新增",
                    "excerpt": "添加高级tag情况"
                },
                "4": {
                    "id": 6,
                    "title": "普通用户新增tag测试",
                    "excerpt": "添加高级tag情况"
                }
            },
            "created_time": "2020-06-22T18:24:55.933995"
        },
        {
            "id": 2,
            "name": "计算机视觉",
            "category_info": {
                "id": 4,
                "name": "技术类别"
            },
            "article_info": {
                "1": {
                    "id": 3,
                    "title": "测试tag新增",
                    "excerpt": "未加tag情况"
                },
                "2": {
                    "id": 4,
                    "title": "测试tag新增",
                    "excerpt": "添加高级tag情况"
                },
                "3": {
                    "id": 5,
                    "title": "测试tag新增",
                    "excerpt": "添加高级tag情况"
                }
            },
            "created_time": "2020-06-22T18:25:03.806592"
        }
    ]
}
```





#### 查看某些tags下的文章

参数中包含请求tag的id，返回包含这些tag的分页文章数据

如果tag为[ ], 默认返回全部文章分页数据

url：api/tags/articles/

请求方式：post

请求参数：

```json
{
    "tag":[6, 7]
}
```

成功返回数据：

```json
{
    "count": 7,
    "next": null,
    "previous": null,
    "results": [
        {
            "id": 8,
            "title": "普通用户新增tag测试",
            "body": "添加高级tag情况",
            "created_time": "2020-06-26T17:08:33.550315",
            "modified_time": "2020-06-26T17:08:33.550315",
            "excerpt_info": "添加高级tag情况",
            "tag_info": {
                "1": {
                    "id": 1,
                    "name": "c/c++"
                },
                "2": {
                    "id": 2,
                    "name": "计算机视觉"
                },
                "3": {
                    "id": 3,
                    "name": "vscode"
                },
                "4": {
                    "id": 7,
                    "name": "知识库"
                },
                "5": {
                    "id": 8,
                    "name": "公告"
                }
            },
            "collection": false,
            "author_info": {
                "id": 1,
                "name": "3460457627@qq.com"
            }
        },
        {
            "id": 9,
            "title": "普通用户新增tag测试",
            "body": "添加高级tag情况",
            "created_time": "2020-06-26T17:10:40.356501",
            "modified_time": "2020-06-26T17:10:40.356501",
            "excerpt_info": "添加高级tag情况",
            "tag_info": {
                "1": {
                    "id": 1,
                    "name": "c/c++"
                },
                "2": {
                    "id": 2,
                    "name": "计算机视觉"
                },
                "3": {
                    "id": 3,
                    "name": "vscode"
                },
                "4": {
                    "id": 7,
                    "name": "知识库"
                },
                "5": {
                    "id": 8,
                    "name": "公告"
                }
            },
            "collection": false,
            "author_info": {
                "id": 1,
                "name": "3460457627@qq.com"
            }
        },
        ...太长了，截取一部分
    ]
}
```



### 文章

#### 查看全部文章列表

url：api/articles/

请求方式：get

此请求token选填，只有在携带token的情况下可以可以判断collection是否为true，即判断该用户是否收藏了此文章；不携带token无法判断，默认返回false

返回数据：

```json
{
    "count": 16,
    "next": "http://127.0.0.1:8000/api/articles/?page=2",
    "previous": null,
    "results": [
        {
            "id": 1,
            "title": "测试tag新增",
            "body": "未加tag情况",
            "created_time": "2020-06-26T15:20:36.065358",
            "modified_time": "2020-06-26T15:20:36.065358",
            "excerpt": "未加tag情况",
            "tag_info": {},
            "collection": false,
            "author_info": {
                "id": 1,
                "name": "3460457627@qq.com"
            }
        },
        {
            "id": 2,
            "title": "测试tag新增",
            "body": "未加tag情况",
            "created_time": "2020-06-26T15:22:54.197763",
            "modified_time": "2020-06-26T15:22:54.198761",
            "excerpt": "未加tag情况",
            "tag_info": {},
            "collection": false,
            "author_info": {
                "id": 1,
                "name": "3460457627@qq.com"
            }
        },
        {
            "id": 3,
            "title": "测试tag新增",
            "body": "未加tag情况",
            "created_time": "2020-06-26T15:24:59.229511",
            "modified_time": "2020-06-26T15:24:59.229511",
            "excerpt": "未加tag情况",
            "tag_info": {
                "1": {
                    "id": 1,
                    "name": "c/c++"
                },
                "2": {
                    "id": 2,
                    "name": "计算机视觉"
                },
                "3": {
                    "id": 3,
                    "name": "vscode"
                }
            },
            "collection": false,
            "author_info": {
                "id": 1,
                "name": "3460457627@qq.com"
            }
        },
        ...太长截掉了
    ]
}
```





#### 查看文章详情

url：api/articles/{id}/

请求方式：get

此接口token选填，只有在携带token的情况下可以可以判断collection是否为true，即判断该用户是否收藏了此文章；不携带token无法判断，默认返回false

返回数据：

```json
{
    "status": 0,
    "msg": "ok",
    "results": {
        "id": 20,
        "title": "测试标题",
        "body": "测试文章内容",
        "created_time": "2020-07-03T21:33:49.718889",
        "modified_time": "2020-07-03T21:33:49.718889",
        "excerpt": "测试文章内容",
        "tag_info": {
            "1": {
                "id": 4,
                "name": "提问"
            },
            "2": {
                "id": 5,
                "name": "项目记录"
            }
        },
        "collection": true,
        "author_info": {
            "id": 7,
            "name": "中文用户名"
        }
    }
}
```

| 部分返回数据说明 | 说明                |
| ---------------- | ------------------- |
| created_time     | 文章创建时间        |
| modified_time    | 文章修改时间        |
| excerpt          | 文章摘要，取前200字 |
| tag_info         | 文章所属的标签信息  |
| collection       | 是否被请求用户收藏  |
| author_info      | 文章作者信息        |



#### 新增文章 

url：api/articles/

请求方式：post

携带token

请求参数（普通标签）：

```json
{
    "title":"测试标题",
    "body":"测试文章内容",
    "tag":[4, 5]
}
```

| 请求参数 | 必填  | 参数类型 | 参数名称       |
| -------- | ----- | -------- | -------------- |
| title    | true  | String   | 文章标题       |
| body     | true  | String   | 文章内容       |
| tag      | false | 数组     | 文章所属的标签 |

成功后返回数据：

```json
{
    "status": 0,
    "msg": "新增成功",
    "results": {
        "id": 20,
        "title": "测试标题",
        "body": "测试文章内容",
        "created_time": "2020-07-03T21:33:49.718889",
        "modified_time": "2020-07-03T21:33:49.718889",
        "excerpt": "测试文章内容",
        "tag_info": {
            "1": {
                "id": 4,
                "name": "提问"
            },
            "2": {
                "id": 5,
                "name": "项目记录"
            }
        },
        "collection": false,
        "author_info": {
            "id": 7,
            "name": "中文用户名"
        }
    }
}
```



请求参数（高级标签，用户为普通用户）：

```json
{
    "title":"测试添加高级标签拦截",
    "body":"测试添加高级标签拦截",
    "tag":[7, 8]
}
```

返回数据：

```json
{
    "status": 1,
    "msg": "error",
    "results": "不允许使用 '知识库'  '公告' 这些管理员标签"
}
```





#### 全局/局部更新文章

url：api/articles/{id}/

请求方式：put/patch

url中id为文章的id

携带token，token中的id需与文章的作者id相同

请求参数：

```json
{
    "title":"修改测试标题",
    "body":"修改测试内容",
    "tag":[6, 7]
}
```

| 请求参数 | 必填                    | 参数类型 | 参数名称       |
| -------- | ----------------------- | -------- | -------------- |
| title    | true(put), false(patch) | String   | 文章标题       |
| body     | true(put), false(patch) | String   | 文章内容       |
| tag      | false                   | 数组     | 文章所属的标签 |

返回数据

```json
{
    "id": 20,
    "title": "修改测试标题",
    "body": "修改测试内容",
    "created_time": "2020-07-03T21:33:49.718889",
    "modified_time": "2020-07-03T22:44:59.348539",
    "excerpt": "修改测试内容",
    "tag_info": {
        "1": {
            "id": 6,
            "name": "学习分享"
        },
        "2": {
            "id": 7,
            "name": "知识库"
        }
    },
    "collection": true,
    "author_info": {
        "id": 7,
        "name": "中文用户名"
    }
}
```





#### 删除文章

url：api/articles/{id}/

请求方式：delete

url中id为文章的id

携带token，token中的id需与文章的作者id相同

成功后返回数据：

```json
{
    "status": 0,
    "msg": "删除成功"
}
```

对应的文章被打上删除标记，不会再被获取到



#### 获取某个用户发布的所有文章

url：api/user/{id}/articles/

请求方式：get

url中id为用户的id

不需要携带token

请求：http://127.0.0.1:8000/api/user/7/articles/

返回数据：

```json
{
    "count": 3,
    "next": null,
    "previous": null,
    "results": [
        {
            "id": 17,
            "title": "测试标题",
            "body": "测试文章内容",
            "created_time": "2020-07-03T21:31:18.452796",
            "modified_time": "2020-07-03T21:31:18.452796",
            "excerpt": "测试文章内容",
            "tag_info": {},
            "collection": false,
            "author_info": {
                "id": 7,
                "name": "中文用户名"
            }
        },
        {
            "id": 18,
            "title": "测试标题",
            "body": "测试文章内容",
            "created_time": "2020-07-03T21:32:20.089554",
            "modified_time": "2020-07-03T21:32:20.089554",
            "excerpt": "测试文章内容",
            "tag_info": {},
            "collection": false,
            "author_info": {
                "id": 7,
                "name": "中文用户名"
            }
        },
        {
            "id": 19,
            "title": "测试标题",
            "body": "测试文章内容",
            "created_time": "2020-07-03T21:32:53.670180",
            "modified_time": "2020-07-03T21:32:53.670180",
            "excerpt": "测试文章内容",
            "tag_info": {},
            "collection": false,
            "author_info": {
                "id": 7,
                "name": "中文用户名"
            }
        }
    ]
}
```



### 评论

#### 查看某文章评论

url：api/articles/{id}/comments/

请求方式：get

url中id为文章的id

返回数据：

```json
{
    "count": 1,
    "next": null,
    "previous": null,
    "results": [
        {
            "id": 1,
            "text": "这是id为19的文章的评论一",
            "article": 19,
            "commenter_info": {
                "id": 7,
                "username": "中文用户名",
                "avatar": ""
            },
            "reply1": null,
            "reply2": null,
            "child_comment": {
                "1": {
                    "id": 2,
                    "text": "这是id为19的文章的评论二",
                    "commenter_info": {
                        "id": 7,
                        "username": "中文用户名",
                        "avatar": ""
                    },
                    "created_time": "2020-07-03T23:14:10.804826",
                    "reply2": null
                },
                "2": {
                    "id": 3,
                    "text": "这是id为19的文章的评论二",
                    "commenter_info": {
                        "id": 7,
                        "username": "中文用户名",
                        "avatar": ""
                    },
                    "created_time": "2020-07-03T23:14:28.991428",
                    "reply2": 2
                }
            },
            "created_time": "2020-07-03T23:10:01.450669"
        }
    ]
}
```



#### 新增评论

url：api/comments/

请求方式：post

携带token

请求参数：

```json
{
    "article":19,
    "text":"这是id为19的文章的评论二",
    "reply1":1,
    "reply2":2
}
```

| 请求参数 | 必填  | 参数类型 | 参数名称                                                     |
| -------- | ----- | -------- | ------------------------------------------------------------ |
| article  | true  | int      | 所评论的文章的id                                             |
| text     | true  | String   | 评论内容                                                     |
| reply1   | false | int      | 第一级（最开始）的评论的id，reply1为空则此评论为为第一级评论 |
| reply2   | false | int      | 所回复的评论的id，reply2为空则此评论是第一级评论下的评论，没有回复别人 |

|                  | reply1（评论的id）   | reply2（评论的id） |
| ---------------- | -------------------- | ------------------ |
| 文章下评论       | null                 | null               |
| 一级评论下评论   | 某文章下一级评论的id | null               |
| 对其他评论的回复 | 某文章下一级评论的id | 一级评论下的评论   |

成功后返回数据：

```json
{
    "id": 3,
    "text": "这是id为19的文章的评论二",
    "article": 19,
    "commenter_info": {
        "id": 7,
        "username": "中文用户名",
        "avatar": ""
    },
    "reply1": 1,
    "reply2": 2,
    "child_comment": {},
    "created_time": "2020-07-03T23:14:28.991428"
}
```



#### 获取用户的所有评论

可以用于个人中心用户自己查看吧

url：api/user/{id}/comments/

请求方式：get

url中id为用户的id

携带token，token 中id须与url中的id一致

返回数据：

```json
{
    "count": 3,
    "next": null,
    "previous": null,
    "results": [
        {
            "id": 1,
            "text": "这是id为19的文章的评论一",
            "article": 19,
            "commenter_info": {
                "id": 7,
                "username": "中文用户名",
                "avatar": ""
            },
            "reply1": null,
            "reply2": null,
            "created_time": "2020-07-03T23:10:01.450669"
        },
        {
            "id": 2,
            "text": "这是id为19的文章的评论二",
            "article": 19,
            "commenter_info": {
                "id": 7,
                "username": "中文用户名",
                "avatar": ""
            },
            "reply1": 1,
            "reply2": null,
            "created_time": "2020-07-03T23:14:10.804826"
        },
        {
            "id": 3,
            "text": "这是id为19的文章的评论二",
            "article": 19,
            "commenter_info": {
                "id": 7,
                "username": "中文用户名",
                "avatar": ""
            },
            "reply1": 1,
            "reply2": 2,
            "created_time": "2020-07-03T23:14:28.991428"
        }
    ]
}
```



#### 删除评论

url：	

请求方式：delete

url中id为评论的id

携带token，token中的id需与评论者id相同

返回数据：

```json
{
    "status": 0,
    "msg": "删除成功"
}
```

同时将数据库中对应评论标记为删除，不再会获取到



## 用户操作

### 收藏

#### 获取用户收藏的文章

url：api/userfav/

请求方式：get

携带token

返回数据：

```json
{
    "count": 1,
    "next": null,
    "previous": null,
    "results": [
        {
            "id": 15,
            "author_info": {
                "id": 7,
                "name": "中文用户名"
            },
            "article_info": {
                "id": 20,
                "title": "修改测试标题",
                "excerpt": "修改测试内容"
            }
        }
    ]
}
```



#### 新增用户收藏

url：api/userfav/

请求方式：post

携带token

请求参数：

```json
{
    "article":18
}
```

返回数据：

```json
{
    "status": 0,
    "msg": "ok",
    "results": {
        "id": 17,
        "author_info": {
            "id": 7,
            "name": "中文用户名"
        },
        "article_info": {
            "id": 18,
            "title": "测试标题",
            "excerpt": "测试文章内容"
        }
    }
}
```

再次发送相同参数：

```json
{
    "status": 1,
    "msg": [
        "此文章已经收藏"
    ]
}
```





#### 删除收藏

url：api/userfav/{id}/

请求方式：delete

携带token， url中id为要取消收藏的文章的id

返回数据：

```json
{
    "status": 0,
    "msg": "ok"
}
```

同时收藏数据被删除



### 浏览记录

#### 获取用户的浏览记录

url：api/userhistory/

请求方式：get

携带token

返回数据：

```json
{
    "count": 1,
    "next": null,
    "previous": null,
    "results": [
        {
            "id": 1,
            "user_info": {
                "id": 7,
                "name": "中文用户名"
            },
            "article_info": {
                "id": 12,
                "title": "普通用户新增tag测试",
                "excerpt": "添加高级tag情况"
            }
        }
    ]
}
```





#### 新增浏览记录

url：api/userhistory/

请求方式：post

携带token

参数：

```json
{
    "article":12
}
```

返回数据：

```json
{
    "status": {
        "id": 1,
        "user_info": {
            "id": 7,
            "name": "中文用户名"
        },
        "article_info": {
            "id": 12,
            "title": "普通用户新增tag测试",
            "excerpt": "添加高级tag情况"
        }
    },
    "msg": "ok"
}
```



#### 删除浏览记录

url：api/userhistory/{id}/

请求方式：delete

携带token， url中id为要删除浏览记录的文章的id

返回数据：

```json
{
    "status": 0,
    "msg": "ok"
}
```

同时浏览记录数据被删除







